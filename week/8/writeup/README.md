# Writeup 8 - Binaries II

Name: *Wyeth Force*
Section: *Section 0101*

I pledge on my honor that I have not given or received any unauthorized assistance on this assignment or examination.

Digital acknowledgement: *Wyeth Force*

## Assignment Writeup

### Part 1 (100 pts)
Answer the following questions regarding the server executable (for which source is provided).

1. How is the per-session administrator password generated? Are there any inherent weaknesses in this implementation?

The per-session password is a random string of characters generated by the main method.  The password has a fixed length.  Besides the fact that the password can be obtained from the
stack with format strings, I don't see any vulnerabilites in the functions used to generate the password.  The main vulnerabilities we covered in class were the buffer overflow and format
string vulnerabilities, and I don't think either apply to the password generation itself.


2. Describe two vulnerabilities in this program. Provide specific line numbers and classifications of the vulnerability. Explain potential ramifications as well as ways to avoid these vulnerabilities when writing code.

The first key vulnerability is a format string vulnerability in the cipher function, line 38.  This line contains a printf statement that has an argument entirely within parentheses.  As 
a result, an attacker can use format string inputs to get data from the stack.  I was able to find the password using the format string '%29$f', which when passed through the rot13 cipher 
comes out as '%29$s'.  This command printed out per-session password.  The way to avoid such an error would be to always include a format string in the program itself, and to never rely 
on the user input for the format string.

The second major vulerability is the potential for a buffer overflow attack in the exec_command function, line 68.  On this line, there is a gets(buff) call, where buff is of size 64.  
This allows an attacker to provide an input with a size greater than 64, which can mess with the stack.  The best way to avoid this attack would be to used a safer functions such as 
'fgets' in conjunction with dynamic memory allocation.


3. What is the flag?

CMSC389R-{expl017-2-win}


4. Describe the process you followed to obtain the flag: vulnerabilities exploited, your inputs to the server in a human-readable format, etc. If you create any helper code please include it.

As described in question 2, I exploited the format string vulnerability by passing in the argument '%29$f' when asked for a string to encrypt/decrypt for the cipher function.  In order to 
determine what value to use, I had to try each piece of the stack, so '%1$f', '%2$f', and so on until I found the password at the 29th position.  As mentioned earlier, I used an 'f' in 
my format string because it would be transformed by the rot13 shift to 's', which is what I needed in the format string.  Upon entering the corrent format string, the per-session password 
was printed out.  I was then able to use this password to achieve admin access and the ability to run commands.

In order to exploit the second vulnerability, all I had to do was provide a buffer that was larger than 64.  Basically I just entered in a lot of spaces, and at the end called 'cat flag'.  
I ended up having to add some trailing whitespace for whatever reason, but I was then able to get the server to dump the flag.
